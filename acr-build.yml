version: v1.1.0
steps:
  - id: ccd
    build: >
      -t {{.Run.Registry}}/ccd/logstash:ccd-{{.Run.ID}} -t {{.Run.Registry}}/ccd/logstash:ccd-latest -t {{.Run.Registry}}/ccd/logstash:latest
      --build-arg conf=ccd_logstash.conf.in
      .
    keep: true

  - id: probate
    build: >
      -t {{.Run.Registry}}/ccd/logstash:probate-{{.Run.ID}} -t {{.Run.Registry}}/ccd/logstash:probate-latest
      --build-arg conf=probate_logstash.conf.in
      .
    keep: true

  - id: push-images
    push:
      - "{{.Run.Registry}}/ccd/logstash/ccd:latest"
      - "{{.Run.Registry}}/ccd/logstash/probate:latest"
    when:
      - runtime
